<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"><title>小乐园</title><meta name="author" content="小杨"><meta name="copyright" content="小杨"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta property="og:type" content="website">
<meta property="og:title" content="小乐园">
<meta property="og:url" content="http://example.com/index.html">
<meta property="og:site_name" content="小乐园">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="http://example.com/img/1235.png">
<meta property="article:author" content="小杨">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="http://example.com/img/1235.png"><link rel="shortcut icon" href="/img/1235.png"><link rel="canonical" href="http://example.com/"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6/css/all.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox.css" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: undefined,
  translate: undefined,
  noticeOutdate: undefined,
  highlight: {"plugin":"highlighjs","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '',
  date_suffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: undefined,
  lightbox: 'fancybox',
  Snackbar: undefined,
  source: {
    justifiedGallery: {
      js: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery@2/dist/fjGallery.min.js',
      css: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery@2/dist/fjGallery.min.css'
    }
  },
  isPhotoFigcaption: false,
  islazyload: false,
  isAnchor: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: '小乐园',
  isPost: false,
  isHome: true,
  isHighlightShrink: false,
  isToc: false,
  postUpdate: '2022-06-03 22:32:18'
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(win=>{
    win.saveToLocal = {
      set: function setWithExpiry(key, value, ttl) {
        if (ttl === 0) return
        const now = new Date()
        const expiryDay = ttl * 86400000
        const item = {
          value: value,
          expiry: now.getTime() + expiryDay,
        }
        localStorage.setItem(key, JSON.stringify(item))
      },

      get: function getWithExpiry(key) {
        const itemStr = localStorage.getItem(key)

        if (!itemStr) {
          return undefined
        }
        const item = JSON.parse(itemStr)
        const now = new Date()

        if (now.getTime() > item.expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return item.value
      }
    }
  
    win.getScript = url => new Promise((resolve, reject) => {
      const script = document.createElement('script')
      script.src = url
      script.async = true
      script.onerror = reject
      script.onload = script.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        script.onload = script.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(script)
    })
  
      win.activateDarkMode = function () {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      win.activateLightMode = function () {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }
      const t = saveToLocal.get('theme')
    
          if (t === 'dark') activateDarkMode()
          else if (t === 'light') activateLightMode()
        
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
    const detectApple = () => {
      if(/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
    })(window)</script><meta name="generator" content="Hexo 6.2.0"></head><body><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img is-center"><img src="/img/1235.png" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="sidebar-site-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">5</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">2</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">3</div></a></div><hr/></div></div><div class="page" id="body-wrap"><header class="full_page" id="page-header" style="background-image: url('/img/2.jfif')"><nav id="nav"><span id="blog_name"><a id="site-name" href="/">小乐园</a></span><div id="menus"><div id="toggle-menu"><a class="site-page"><i class="fas fa-bars fa-fw"></i></a></div></div></nav><div id="site-info"><h1 id="site-title">小乐园</h1></div><div id="scroll-down"><i class="fas fa-angle-down scroll-down-effects"></i></div></header><main class="layout" id="content-inner"><div class="recent-posts" id="recent-posts"><div class="recent-post-item"><div class="post_cover left"><a href="/2022/06/03/ThreadLocal/" title="ThreadLocal"><img class="post_bg" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="ThreadLocal"></a></div><div class="recent-post-info"><a class="article-title" href="/2022/06/03/ThreadLocal/" title="ThreadLocal">ThreadLocal</a><div class="article-meta-wrap"><span class="post-meta-date"><i class="far fa-calendar-alt"></i><span class="article-meta-label">发表于</span><time datetime="2022-06-03T15:34:13.000Z" title="发表于 2022-06-03 23:34:13">2022-06-03</time></span><span class="article-meta"><span class="article-meta-separator">|</span><i class="fas fa-inbox"></i><a class="article-meta__categories" href="/categories/Java/">Java</a></span></div><div class="content">为什么ThreadLocal可以避免线程冲突？
ThreadLocal类里面有一个内部类ThreadLocalMap
ThreadLocalMap类里面也存在一个内部类Entry，同时Entry继承WeakReference，弱引用对象每次GC时会被回收。Entry.value实际上是我们存在ThreadLocal里面的值
Thread类里面有一个成员变量ThreadLocal.ThreadLocalMap threadLocals
ThreadLocalMap类里面有一个成员变量private Entry[] table数组
每个线程都有自己的ThreadLocalMap对象，我们调用get,set,remove实际上是在操作当前线程的ThreadLocalMap.table数组（Thread t &#x3D; Thread.currentThread();ThreadLocalMap map &#x3D; getMap(t)），线程之间自然不会发生并发冲突
ThreadLocalMap里面的key是ThreadLocal对象

123456789101112131415161718 ...</div></div></div><div class="recent-post-item"><div class="post_cover right"><a href="/2022/06/03/2022-1/" title="2022"><img class="post_bg" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="2022"></a></div><div class="recent-post-info"><a class="article-title" href="/2022/06/03/2022-1/" title="2022">2022</a><div class="article-meta-wrap"><span class="post-meta-date"><i class="far fa-calendar-alt"></i><span class="article-meta-label">发表于</span><time datetime="2022-06-02T16:53:21.000Z" title="发表于 2022-06-03 00:53:21">2022-06-03</time></span><span class="article-meta"><span class="article-meta-separator">|</span><i class="fas fa-inbox"></i><a class="article-meta__categories" href="/categories/life/">生活</a></span></div><div class="content">5月31日正式离职了，17年10月入职公司，接近5年的时间。终于不用去维护系统啦，觉得轻松了好多。
今天偶然看到英国女王伊丽莎白2007年发表的圣诞致辞，其中一段她是这样说的：”随着年龄的增长，人们更能意识到变化。回忆50年前的往事，让人赞叹世道沧桑，同时也让人认识到何为永恒”。前一家公司接近5年的工作经历和别人50年比起来确实微不足道，但和5年前相比不管是自己还是世界也确实发生了好多变化。
最让人意想不到的两件事：疫情和俄乌战争。疫情已经持续快3年了，国内还不知道什么时候能结束，戴口罩和测核酸不知不觉间已经成为了生活的一部分；以前觉得战争离我们很远，其实战争的火焰一直没有熄灭，不喜欢那些虚伪的政客。
6年前，在武汉找了一段时间工作后有了转行的想法。目前来看当初的选择可能不是最好的，但无疑是正确的。不知道以后会怎么样，现在的我还想继续做5年Java开发，希望可以尽快找到满意的工作。虽然今年大环境不好，但是近几年每年的毕业生数量都创新高，往后看今年也是最好的一年。既然已经辞职，安心找工作便好了。
最近几年最开心的事是买了switch以及成为了一名光之战士，如果可以早点接触到《塞尔达传说》 ...</div></div></div><div class="recent-post-item"><div class="post_cover left"><a href="/2022/06/02/%E5%BB%B6%E8%BF%9F%E5%8A%A0%E8%BD%BD%E5%92%8C%E5%8D%95%E4%BE%8B/" title="延迟加载和单例"><img class="post_bg" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="延迟加载和单例"></a></div><div class="recent-post-info"><a class="article-title" href="/2022/06/02/%E5%BB%B6%E8%BF%9F%E5%8A%A0%E8%BD%BD%E5%92%8C%E5%8D%95%E4%BE%8B/" title="延迟加载和单例">延迟加载和单例</a><div class="article-meta-wrap"><span class="post-meta-date"><i class="far fa-calendar-alt"></i><span class="article-meta-label">发表于</span><time datetime="2022-06-02T15:34:39.000Z" title="发表于 2022-06-02 23:34:39">2022-06-02</time></span><span class="article-meta"><span class="article-meta-separator">|</span><i class="fas fa-inbox"></i><a class="article-meta__categories" href="/categories/other/">其他</a></span></div><div class="content">双重检查锁定若不使用volatile，两个线程同时访问getInstance()方法，其中一个线程正在初始化对象，另一个线程检查instance不为空。初始化可以理解为：1.分配对象的内存空间；2.初始化对象；3.设置instance指向刚分配的内存地址。2和3操作可能被重排序，此时初始化操作并未完成，使用volatile关键字可以禁止重排序。
12345678910111213141516public class DoubleCheckedLocking &#123;    private static volatile Instance instance;    public static Instance getInstance()&#123;        if(instance==null)&#123;            synchronized (DoubleCheckedLocking.class)&#123;                if(instance==null)&#123;                    instance=new Instanc ...</div></div></div><div class="recent-post-item"><div class="post_cover right"><a href="/2022/06/02/hello-world/" title="Hello World"><img class="post_bg" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Hello World"></a></div><div class="recent-post-info"><a class="article-title" href="/2022/06/02/hello-world/" title="Hello World">Hello World</a><div class="article-meta-wrap"><span class="post-meta-date"><i class="far fa-calendar-alt"></i><span class="article-meta-label">发表于</span><time datetime="2022-06-02T15:08:37.597Z" title="发表于 2022-06-02 23:08:37">2022-06-02</time></span></div><div class="content">Welcome to Hexo! This is your very first post. Check documentation for more info. If you get any problems when using Hexo, you can find the answer in troubleshooting or you can ask me on GitHub.
Quick StartCreate a new post1$ hexo new &quot;My New Post&quot;

More info: Writing
Run server1$ hexo server

More info: Server
Generate static files1$ hexo generate

More info: Generating
Deploy to remote sites1$ hexo deploy

More info: Deployment
</div></div></div><div class="recent-post-item"><div class="post_cover left"><a href="/2018/07/01/2018%E5%B9%B4%E4%B8%AD%E6%80%BB%E7%BB%93/" title="2018年中总结"><img class="post_bg" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="2018年中总结"></a></div><div class="recent-post-info"><a class="article-title" href="/2018/07/01/2018%E5%B9%B4%E4%B8%AD%E6%80%BB%E7%BB%93/" title="2018年中总结">2018年中总结</a><div class="article-meta-wrap"><span class="post-meta-date"><i class="far fa-calendar-alt"></i><span class="article-meta-label">发表于</span><time datetime="2018-06-30T16:00:00.000Z" title="发表于 2018-07-01 00:00:00">2018-07-01</time></span><span class="article-meta"><span class="article-meta-separator">|</span><i class="fas fa-inbox"></i><a class="article-meta__categories" href="/categories/life/">生活</a></span></div><div class="content">大学毕业刚好三年，从事Java工作也有一年半了，虽然中间有几个月的时间是在找工作。但从来没有像现在这样觉得时间过的如此之快。
第一份正式的工作还是亲戚帮忙找的，在一家建筑公司上班，只坚持了半年，过年的时候便辞职了。当初只和经理说了一声，也没有走正常的离职程序，现在回想起来觉得好傻。辞职之后肯定要找工作，刚好有一个同学和我情况差不多，于是和他商量年后一起去武汉找工作。住了几天旅馆之后，联系了一位房东，我们只想租一个月，结果别人说最少半年，不过最后还是找到了一家满意的。毕业之后经历了很多类似的事情，从什么都不懂，到渐渐熟悉。
房东的家在一个校区里面，校门那里刚好有一家做IT培训的机构。因为高中时视力已经近似了，一想到做编程方面的工作，要每天面对电脑，有一次我还心想这辈子是不会和计算机打交道了，可如今却成了程序员。大概一个半月之后，和我一起找工作的同学通过亲戚介绍，继续去做建筑方面的工作。而我在武汉多待了一个月，除了建筑方面的工作，也不知道能做啥，但又确实不喜欢，这次找工作算是以失败告终。后来不知为何有了学编程的想法，在网上下载了一些学习视频后便回家开始自学编程了，记得那时刚好是16年端午节 ...</div></div></div><nav id="pagination"><div class="pagination"><span class="page-number current">1</span></div></nav></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="is-center"><div class="avatar-img"><img src="/img/1235.png" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info__name">小杨</div><div class="author-info__description"></div></div><div class="card-info-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">5</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">2</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">3</div></a></div><a id="card-info-btn" target="_blank" rel="noopener" href="https://github.com/xxxxxx"><i class="fab fa-github"></i><span>Follow Me</span></a></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn fa-shake"></i><span>公告</span></div><div class="announcement_content">不努力的光之战士</div></div><div class="sticky_layout"><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>最新文章</span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/2022/06/03/ThreadLocal/" title="ThreadLocal"><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="ThreadLocal"/></a><div class="content"><a class="title" href="/2022/06/03/ThreadLocal/" title="ThreadLocal">ThreadLocal</a><time datetime="2022-06-03T15:34:13.000Z" title="发表于 2022-06-03 23:34:13">2022-06-03</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2022/06/03/2022-1/" title="2022"><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="2022"/></a><div class="content"><a class="title" href="/2022/06/03/2022-1/" title="2022">2022</a><time datetime="2022-06-02T16:53:21.000Z" title="发表于 2022-06-03 00:53:21">2022-06-03</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2022/06/02/%E5%BB%B6%E8%BF%9F%E5%8A%A0%E8%BD%BD%E5%92%8C%E5%8D%95%E4%BE%8B/" title="延迟加载和单例"><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="延迟加载和单例"/></a><div class="content"><a class="title" href="/2022/06/02/%E5%BB%B6%E8%BF%9F%E5%8A%A0%E8%BD%BD%E5%92%8C%E5%8D%95%E4%BE%8B/" title="延迟加载和单例">延迟加载和单例</a><time datetime="2022-06-02T15:34:39.000Z" title="发表于 2022-06-02 23:34:39">2022-06-02</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2022/06/02/hello-world/" title="Hello World"><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Hello World"/></a><div class="content"><a class="title" href="/2022/06/02/hello-world/" title="Hello World">Hello World</a><time datetime="2022-06-02T15:08:37.597Z" title="发表于 2022-06-02 23:08:37">2022-06-02</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2018/07/01/2018%E5%B9%B4%E4%B8%AD%E6%80%BB%E7%BB%93/" title="2018年中总结"><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="2018年中总结"/></a><div class="content"><a class="title" href="/2018/07/01/2018%E5%B9%B4%E4%B8%AD%E6%80%BB%E7%BB%93/" title="2018年中总结">2018年中总结</a><time datetime="2018-06-30T16:00:00.000Z" title="发表于 2018-07-01 00:00:00">2018-07-01</time></div></div></div></div><div class="card-widget card-categories"><div class="item-headline">
            <i class="fas fa-folder-open"></i>
            <span>分类</span>
            
            </div>
            <ul class="card-category-list" id="aside-cat-list">
            <li class="card-category-list-item "><a class="card-category-list-link" href="/categories/Java/"><span class="card-category-list-name">Java</span><span class="card-category-list-count">1</span></a></li><li class="card-category-list-item "><a class="card-category-list-link" href="/categories/other/"><span class="card-category-list-name">其他</span><span class="card-category-list-count">1</span></a></li><li class="card-category-list-item "><a class="card-category-list-link" href="/categories/life/"><span class="card-category-list-name">生活</span><span class="card-category-list-count">2</span></a></li>
            </ul></div><div class="card-widget card-tags"><div class="item-headline"><i class="fas fa-tags"></i><span>标签</span></div><div class="card-tag-cloud"><a href="/tags/Java/" style="font-size: 1.1em; color: #999">Java</a> <a href="/tags/%E5%8D%95%E4%BE%8B/" style="font-size: 1.1em; color: #999">单例</a></div></div><div class="card-widget card-archives"><div class="item-headline"><i class="fas fa-archive"></i><span>归档</span></div><ul class="card-archive-list"><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2022/06/"><span class="card-archive-list-date">六月 2022</span><span class="card-archive-list-count">4</span></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2018/07/"><span class="card-archive-list-date">七月 2018</span><span class="card-archive-list-count">1</span></a></li></ul></div><div class="card-widget card-webinfo"><div class="item-headline"><i class="fas fa-chart-line"></i><span>网站资讯</span></div><div class="webinfo"><div class="webinfo-item"><div class="item-name">文章数目 :</div><div class="item-count">5</div></div><div class="webinfo-item"><div class="item-name">本站访客数 :</div><div class="item-count" id="busuanzi_value_site_uv"></div></div><div class="webinfo-item"><div class="item-name">本站总访问量 :</div><div class="item-count" id="busuanzi_value_site_pv"></div></div><div class="webinfo-item"><div class="item-name">最后更新时间 :</div><div class="item-count" id="last-push-date" data-lastPushDate="2022-06-03T14:32:18.132Z"></div></div></div></div></div></div></main><footer id="footer"><div id="footer-wrap"><div class="copyright">&copy;2020 - 2022 By 小杨</div><div class="framework-info"><span>框架 </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><span>主题 </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="darkmode" type="button" title="浅色和深色模式转换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside_config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button id="go-up" type="button" title="回到顶部"><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox.umd.js"></script><div class="js-pjax"></div><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div></body></html>